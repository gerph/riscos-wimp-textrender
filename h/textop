/*******************************************************************
 * File:        textop
 * Purpose:     Definitions for the Wimp_TextOp
 * Author:      Gerph
 * Date:        01 Feb 2026
 ******************************************************************/

#ifndef TEXTOP_H
#define TEXTOP_H

#include "textrender.h"

#define WimpTextOp_SetTextColour        (0)
#define WimpTextOp_TextWidth            (1)
#define WimpTextOp_RenderText           (2)
#define WimpTextOp_GetSplitPoint        (3)
#define WimpTextOp_TruncateWithEllipsis (4)

/* Wimp_TextOp 2 - render */
#define WimpTextOp_RightJustify         (1 << 31)
#define WimpTextOp_VerticalJustify      (1 << 30)
#define WimpTextOp_Offset               (1 << 29)
#define WimpTextOp_VerticalCentre       (1 << 28)
#define WimpTextOp_Style                (1 << 27)

/* Wimp_TextOp 3 - set split point */
#define WimpTextOp_ReturnBBox           (1 << 31)

/*************************************************** Gerph *********
 Function:      textop_settextcolour
 Description:   Wimp_TextOp 0 implementation of setting the colour used for the main text context
 Parameters:    trender-> text rendering context
                fg = foreground colour as &BBGGRR00
                bg = background colour as &BBGGRR00
 Returns:       none
 ******************************************************************/
_kernel_oserror *textop_settextcolour(textrender_t *trender, colour_t fg, colour_t bg);


/*************************************************** Gerph *********
 Function:      textop_stringwidth
 Description:   Wimp_TextOp 1 implementation of reading string width
 Parameters:    trender-> text rendering context
                msg-> the text to size
                max = the limit, or 0 for the whole string
                widthp-> where to store the width of the string
 Returns:       pointer to error block, or NULL if successful
 ******************************************************************/
_kernel_oserror *textop_stringwidth(textrender_t *trender, const char *msg, int max, int *widthp);

/*************************************************** Gerph *********
 Function:      textop_rendertext
 Description:   Wimp_TextOp 2 implementation of writing text
 Parameters:    trender-> text rendering context
                flags = the rendering flags for the style to render with
                msg-> the text to render
                x, y = where to render in OS units
 Returns:       pointer to error block, or NULL if successful
 ******************************************************************/
_kernel_oserror *textop_rendertext(textrender_t *trender, uint32_t flags, const char *msg, int x, int y);

/*************************************************** Gerph *********
 Function:     textop_getsplitpoint
 Description:  Return the split position within a string, given a
               width and split character
 Parameters:   trender-> text rendering context
               msg-> the string to read the split point of (ctrl-terminated)
               width = the size to split at, or 1<<30 to not split at a width,
                       in OS units
               splitchar = the character to split at, or -1 for none
               splitp-> where the split occurred
 Returns:      pointer to error or NULL if none
 ******************************************************************/
_kernel_oserror *textop_getsplitpoint(textrender_t *trender,
                                      const char *msg, int width, int splitchar,
                                      const char **splitp);

/*************************************************** Gerph *********
 Function:     textop_truncatewithellipsis
 Description:  Return the split position within a string, given a
               width and split character
 Parameters:   trender-> text rendering context
               msg-> the string to truncate (ctrl-terminated)
               buffer-> output buffer
               buffersize = the size of buffer, or 0 to read size
               width = the size to split at in OS units
               bufferneededp -> where to store the size we needed
 Returns:      pointer to error or NULL if none
 ******************************************************************/
_kernel_oserror *textop_truncatewithellipsis(textrender_t *trender,
                                             const char *msg,
                                             char *buffer, int buffersize,
                                             int width,
                                             int *bufferneededp);

#endif
